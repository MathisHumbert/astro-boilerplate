---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";

interface Props {
  images: { src: ImageMetadata; alt: string }[];
}

const { images } = Astro.props;
---

<astro-slider class="w-full flex flex-col gap-8 p-grid">
  <h2 class="text-xs uppercase">Slider</h2>
  <div class="w-full max-w-full overflow-hidden">
    <div data-slider class="flex ml-col-3">
      {
        images &&
          images.map((image) => (
            <div class="relative w-col-3-gap shrink-0 flex flex-col gap-[1.2rem] pl-8 pr-8">
              <figure class="relative w-full aspect-square">
                {image?.src && (
                  <Image
                    src={image.src}
                    alt={image.alt}
                    sizes="50vw"
                    class="img-cover"
                    loading="eager"
                    draggable={false}
                  />
                )}
              </figure>
              <p class="text-xs uppercase">Lorem.</p>
              <p class="text-s">
                Lorem ipsum dolor sit, amet consectetur adipisicing elit. Culpa
                iure voluptatibus iusto? Vitae, asperiores.
              </p>
            </div>
          ))
      }
    </div>
  </div>
</astro-slider>

<script>
  import Core from "smooothy";

  import { events } from "../scripts/utils/events";

  class AstroSlider extends HTMLElement {
    slider: Core | null = null;

    connectedCallback() {
      this.slider = new Core(this.querySelector("[data-slider]")!, {
        infinite: true,
        snap: true,
      });

      events.on("update", this.onUpdate);
    }

    disconnectedCallback() {
      if (this.slider) {
        this.slider.destroy();
        this.slider = null;
      }

      events.off("update", this.onUpdate);
    }

    onUpdate = () => this.update();

    update() {
      if (this.slider) {
        this.slider.update();
      }
    }
  }

  customElements.define("astro-slider", AstroSlider);
</script>
